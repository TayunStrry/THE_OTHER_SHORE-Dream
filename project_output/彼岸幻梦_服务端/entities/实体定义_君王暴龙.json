{
	"format_version": "1.21.10",
	"minecraft:entity": {
		"description": {
			"identifier": "starry_map:dragon.tyrannosaurus_rex",
			"is_experimental": false,
			"is_summonable": true,
			"is_spawnable": true,
			"scripts": {
				"animate": [
					"control",
					"control_death",
					"control_move"
				]
			},
			"animations": {
				"control_death": "controller.animation.server.triggering_death_behavior",
				"control_move": "controller.animation.server.tyrannosaurus_rex_move",
				"control": "controller.animation.server.apply_traction_to_target",
				"on_move": "animation.server.tyrannosaurus_rex_move"
			},
			"properties": {
				"property:already_death": {
					"type": "bool",
					"client_sync": true,
					"default": false
				},
				"property:daytime_after": {
					"type": "bool",
					"client_sync": true,
					"default": false
				}
			}
		},
		"component_groups": {
			// 在 君王暴龙 死亡前 的 行为
			"entity_module:before_death": {
				"minecraft:underwater_movement": {
					"value": 0.35
				},
				"minecraft:movement": {
					"value": 0.3
				},
				"minecraft:variable_max_auto_step": {
					"jump_prevented_value": 2.5,
					"controlled_value": 3,
					"base_value": 2.0
				},
				/*
				"minecraft:leashable": {
					"soft_distance": 5,
					"max_distance": 15,
					"hard_distance": 10,
					"on_leash": {
						"event": "minecraft:on_leash",
						"target": "self"
					},
					"on_unleash": {
						"event": "minecraft:on_unleash",
						"target": "self"
					}
				},
				*/
				"minecraft:behavior.random_stroll": {
					"speed_multiplier": 1.5,
					"xz_dist": 10,
					"priority": 3
				},
				"minecraft:behavior.random_look_around": {
					"priority": 5
				},
				"minecraft:behavior.look_at_player": {
					"priority": 6,
					"target_distance": 6,
					"probability": 0.02
				},
				// 监听水与地面的转换事件
				/*
				"minecraft:environment_sensor": {
					"triggers": [
						{
							"filters": {
								"all_of": [
									{
										"test": "bool_property",
										"domain": "property:in_the_water",
										"value": false
									},
									{
										"test": "in_water",
										"operator": "==",
										"value": true
									}
								]
							},
							"event": "entity_event:on_water"
						},
						{
							"filters": {
								"all_of": [
									{
										"test": "bool_property",
										"domain": "property:in_the_water",
										"value": true
									},
									{
										"test": "in_water",
										"operator": "!=",
										"value": true
									}
								]
							},
							"event": "entity_event:on_ground"
						}
					]
				},
				*/
				// 判断是否为白天
				"minecraft:scheduler": {
					"min_delay_secs": 4,
					"max_delay_secs": 8,
					"scheduled_events": [
						{
							"filters": {
								"all_of": [
									{
										"test": "bool_property",
										"domain": "property:daytime_after",
										"value": true
									},
									{
										"test": "is_daytime",
										"value": false
									}
								]
							},
							"event": "entity_event:evening",
							"target": "self"
						},
						{
							"filters": {
								"all_of": [
									{
										"test": "bool_property",
										"domain": "property:daytime_after",
										"value": false
									},
									{
										"test": "is_daytime",
										"value": true
									}
								]
							},
							"event": "entity_event:morning",
							"target": "self"
						}
					]
				},
				// 允许被推动
				"minecraft:pushable": {
					"is_pushable_by_piston": true,
					"is_pushable": true
				}
			},
			// 当 君王暴龙处于 白天 时 的 行为
			"entity_module:morning": {
				"minecraft:damage_sensor": {
					"triggers": [
						{
							"cause": "projectile",
							"damage_multiplier": 1.5
						},
						{
							"cause": "entity_explosion",
							"damage_multiplier": 1.5
						},
						{
							"cause": "fall",
							"deals_damage": false
						},
						{
							"cause": "all",
							"damage_multiplier": 0.0001
						}
					]
				}
			},
			// 当 君王暴龙处于 晚上 时 的 行为
			"entity_module:evening": {
				"minecraft:damage_sensor": {
					"triggers": [
						{
							"cause": "projectile",
							"damage_multiplier": 3
						},
						{
							"cause": "entity_explosion",
							"damage_multiplier": 3
						},
						{
							"cause": "fall",
							"deals_damage": false
						},
						{
							"cause": "all",
							"damage_multiplier": 0.0001
						}
					]
				}
			},
			// 在 君王暴龙 死亡前 的 作战管理
			"entity_module:combat_management": {
				"minecraft:attack": {
					"damage": 32
				},
				// 定义实体的追踪范围, 即实体可以感知玩家的最大距离
				"minecraft:follow_range": {
					"value": 64,
					"max": 128
				},
				"minecraft:behavior.delayed_attack": {
					// 设置行为的优先级, 数字越小优先级越高
					"priority": 1,
					// 调整攻击范围的乘数, 增加攻击距离
					"reach_multiplier": 2.0,
					// 攻击动作的持续时间, 单位为秒
					"attack_duration": 1.5,
					// 攻击命中目标的延迟百分比, 影响攻击节奏
					"hit_delay_pct": 0.35,
					// 是否在攻击时持续追踪目标
					"track_target": true,
					// 发起攻击时播放的声音事件
					"sound_event": "attack",
					// 头部向上旋转的最大角度, 限制攻击时头部的旋转范围
					"y_max_head_rotation": 45
				},
				"minecraft:behavior.nearest_attackable_target": {
					"priority": 0,
					"entity_types": [
						{
							"filters": {
								"test": "is_family",
								"subject": "other",
								"operator": "!=",
								"value": "starry"
							},
							"within_default": 128
						}
					],
					"must_reach": false,
					"must_see": true
				},
				"minecraft:behavior.hurt_by_target": {
					"priority": 4
				}
			},
			// 允许采集资源
			"entity_module:resource_collection": {
				"minecraft:break_blocks": {
					"breakable_blocks": [
						"minecraft:vine",
						"minecraft:bee_nest",
						"minecraft:oak_leaves",
						"minecraft:shroomlight",
						"minecraft:birch_leaves",
						"minecraft:chorus_plant",
						"minecraft:spruce_leaves",
						"minecraft:jungle_leaves",
						"minecraft:acacia_leaves",
						"minecraft:cherry_leaves",
						"minecraft:azalea_leaves",
						"minecraft:chorus_flower",
						"minecraft:mangrove_roots",
						"minecraft:dark_oak_leaves",
						"minecraft:mangrove_leaves",
						"minecraft:nether_wart_block",
						"minecraft:warped_wart_block",
						"minecraft:red_mushroom_block",
						"minecraft:brown_mushroom_block",
						"minecraft:azalea_leaves_flowered",
						"minecraft:oak_log",
						"minecraft:birch_log",
						"minecraft:spruce_log",
						"minecraft:jungle_log",
						"minecraft:acacia_log",
						"minecraft:cherry_log",
						"minecraft:warped_stem",
						"minecraft:dark_oak_log",
						"minecraft:mangrove_log",
						"minecraft:crimson_stem"
					]
				},
				"minecraft:shareables": {
					"singular_pickup": true,
					"all_items": true,
					"items": [
						{
							"item": "minecraft:golden_apple"
						}
					]
				},
				"minecraft:behavior.pickup_items": {
					"can_pickup_to_hand_or_equipment": false,
					"can_pickup_any_item": true,
					"speed_multiplier": 1.25,
					"goal_radius": 32,
					"priority": 2,
					"max_dist": 32
				}
			},
			// 在 君王暴龙 死亡后 的 行为
			"entity_module:after_death": {
				"minecraft:collision_box": {
					"width": 0.1,
					"height": 0.1
				},
				"minecraft:timer": {
					"time": 5,
					"time_down_event": {
						"event": "entity_event:delete",
						"target": "self"
					}
				},
				"minecraft:underwater_movement": {
					"value": 0.0
				},
				"minecraft:movement": {
					"value": 0.0
				},
				"minecraft:pushable": {
					"is_pushable_by_piston": false,
					"is_pushable": false
				},
				"minecraft:body_rotation_blocked": {},
				"minecraft:body_rotation_axis_aligned": {}
			}
		},
		"components": {
			// 基础属性
			"minecraft:type_family": {
				"family": [
					"tyrannosaurus_rex",
					"dragon",
					"monster",
					"starry",
					"mob"
				]
			},
			"minecraft:scale": {
				"value": 2
			},
			"minecraft:collision_box": {
				"width": 3,
				"height": 3
			},
			"minecraft:health": {
				"value": 3500,
				"min": 1
			},
			"minecraft:knockback_resistance": {
				"value": 1.0
			},
			"minecraft:boss": {
				"name": "entity.starry_map:dragon.tyrannosaurus_rex.name",
				"should_darken_sky": true,
				"hud_range": 64
			},
			"minecraft:tick_world": {
				"distance_to_players": 128,
				"never_despawn": true,
				"radius": 2
			},
			"minecraft:inventory": {
				"container_type": "inventory",
				"can_be_siphoned_from": false,
				"restrict_to_owner": false,
				"inventory_size": 256,
				"private": true
			},
			// 事件触发器
			"minecraft:breathable": {
				"generates_bubbles": true,
				"breathes_solids": true,
				"breathes_water": true,
				"breathes_lava": true,
				"breathes_air": true,
				"suffocate_time": 10,
				"total_supply": 15,
				"inhale_time": 0
			},
			"minecraft:nameable": {},
			"minecraft:persistent": {},
			"minecraft:fire_immune": true,
			// 物理属性
			"minecraft:physics": {
				"push_towards_closest_space": false,
				"has_collision": true,
				"has_gravity": true
			},
			// 行为控制
			"minecraft:navigation.generic": {
				// 常规移动
				"avoid_damage_blocks": true,
				"can_walk": true,
				// 开门
				"can_open_iron_doors": true,
				"can_pass_doors": true,
				"can_open_doors": true,
				// 在流体中行动
				"can_path_over_water": true,
				"can_path_over_lava": true,
				"is_amphibious": true,
				"can_sink": true,
				"can_swim": true
			},
			"minecraft:movement.generic": {},
			"minecraft:can_climb": {},
			// 条件带宽
			"minecraft:conditional_bandwidth_optimization": {
				"conditional_values": {
					"max_dropped_ticks": 20,
					"max_optimized_distance": 200,
					"use_motion_prediction_hints": true
				},
				"default_values": {
					"max_dropped_ticks": 10,
					"max_optimized_distance": 100,
					"use_motion_prediction_hints": true
				}
			}
		},
		"events": {
			// 实体诞生事件
			"minecraft:entity_spawned": {
				"add": {
					"component_groups": [
						"entity_module:resource_collection",
						"entity_module:combat_management",
						"entity_module:before_death"
					]
				},
				"queue_command": {
					"command": [
						"effect @s slowness 5 255 true",
						"say 清扫威胁的古龙之王 ! "
					]
				}
			},
			// 实体进入水体事件
			"entity_event:on_water": {
				"set_property": {
					"property:in_the_water": true
				},
				"queue_command": {
					"command": [
						"spreadplayers ~ ~ 5 15 @s"
					]
				}
			},
			// 实体离开水体事件
			"entity_event:on_ground": {
				"set_property": {
					"property:in_the_water": false
				}
			},
			// 实体清晨事件
			"entity_event:morning": {
				"set_property": {
					"property:daytime_after": true
				},
				"queue_command": {
					"command": [
						"title @a[r=64] actionbar 【 @s 】: 弹射物 与 爆炸 抗性上升!!"
					]
				},
				"remove": {
					"component_groups": [
						"entity_module:evening"
					]
				},
				"add": {
					"component_groups": [
						"entity_module:morning"
					]
				}
			},
			// 实体黄昏事件
			"entity_event:evening": {
				"set_property": {
					"property:daytime_after": false
				},
				"queue_command": {
					"command": [
						"title @a[r=64] actionbar 【 @s 】: 弹射物 与 爆炸 抗性下降!!"
					]
				},
				"remove": {
					"component_groups": [
						"entity_module:morning"
					]
				},
				"add": {
					"component_groups": [
						"entity_module:evening"
					]
				}
			},
			// 实体死亡行为事件
			"entity_event:death_behavior": {
				"set_property": {
					"property:already_death": true
				},
				"queue_command": {
					"command": [
						"title @a[r=64] actionbar 【 @s 】: 遭受致命攻击"
					]
				},
				"remove": {
					"component_groups": [
						"entity_module:resource_collection",
						"entity_module:combat_management",
						"entity_module:before_death",
						"entity_module:morning",
						"entity_module:evening"
					]
				},
				"add": {
					"component_groups": [
						"entity_module:after_death"
					]
				}
			},
			// 实体销毁事件
			"entity_event:delete": {
				"queue_command": {
					"command": [
						"loot spawn ~ ~2 ~ loot tyrannosaurus_rex",
						"particle minecraft:knockback_roar_particle ~~~",
						"particle minecraft:knockback_roar_particle ~~~",
						"particle minecraft:knockback_roar_particle ~~~",
						"opal:unload_inventory_destroy"
					]
				}
			},
			// 强制回归事件
			"entity_event:apply_traction_to_target": {
				"sequence": [
					{
						"filters": {
							"test": "distance_to_nearest_player",
							"operator": ">=",
							"value": 48
						},
						"queue_command": {
							"command": [
								"opal:apply_traction_to_target @r"
							]
						}
					}
				]
			}
		}
	}
}